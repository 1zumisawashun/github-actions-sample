on:
  pull_request:
    types: [ready_for_review]

name: Slack Notification When PR become ready for review

jobs:
  add-assignees:
    runs-on: ubuntu-latest
    if: ${{ ! contains(fromJson('["renovate[bot]", "dependabot[bot]"]'), github.actor) }}
    permissions:
      pull-requests: write
    steps:
      - uses: actions/checkout@v3
        with:
          sparse-checkout: .github/scripts/add-assignees.js
      - uses: actions/github-script@v7
        with:
          # @see https://docs.github.com/ja/rest/issues/assignees?apiVersion=2022-11-28#add-assignees-to-an-issue
          # @description å¼•æ•°ã®github, context, coreã¯ã€actions/github-scriptç‹¬è‡ªã®propsãªã®ã§github actions contextã¨ç•°ãªã‚‹
          # @description github-scriptã®readmeã«ã‚‚è¨˜è¼‰ãŒã‚ã‚‹ï¼ˆ[è©³ç´°](https://github.com/actions/github-script)ï¼‰
          # @description ä¾‹ãˆã°contextã¯[ã“ã¡ã‚‰](https://github.com/actions/toolkit/blob/master/packages/github/src/context.ts)ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹
          # @description ä¾‹ãˆã°github.restãŒå–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ã€ãã‚Œã‚’ä½¿ã£ã¦APIã‚’å©ã
          script: |
            const script = require('./.github/scripts/add-assignees.js')
            await script({github, context, core})

  create-comment:
    runs-on: ubuntu-latest
    if: ${{ ! contains(fromJson('["renovate[bot]", "dependabot[bot]"]'), github.actor) }}
    permissions:
      pull-requests: write
    steps:
      - uses: actions/checkout@v3
        with:
          sparse-checkout: .github/scripts/create-comment.js
      - uses: actions/github-script@v7
        with:
          # @see https://docs.github.com/ja/rest/issues/comments?apiVersion=2022-11-28#create-an-issue-comment
          script: |
            const script = require('./.github/scripts/create-comment.js')
            await script({github, context, core})

  write-summary:
    runs-on: ubuntu-latest
    if: ${{ ! contains(fromJson('["renovate[bot]", "dependabot[bot]"]'), github.actor) }}
    steps:
      - uses: actions/checkout@v3
        with:
          sparse-checkout: .github/scripts/write-summary.js
      - uses: actions/github-script@v7
        with:
          script: |
            const script = require('./.github/scripts/write-summary.js')
            await script({github, context, core})

  slack-notification:
    runs-on: ubuntu-latest
    if: ${{ ! contains(fromJson('["renovate[bot]", "dependabot[bot]"]'), github.actor) }}
    steps:
      - uses: actions/checkout@v2.2.0
      - uses: rtCamp/action-slack-notify@v2
        # https://book.st-hakky.com/hakky/github-actions-result-notification-to-slack/
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_INCOMING_WEBHOOK_URL }}
          SLACK_MESSAGE: |
            ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™ğŸ™
            <${{ github.event.pull_request.html_url }}|${{ github.event.pull_request.title }}> by ${{ github.event.pull_request.user.login }}
