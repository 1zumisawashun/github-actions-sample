on:
  pull_request:
    types: [ready_for_review]

name: Slack Notification When PR become ready for review

jobs:
  add-assignees:
    runs-on: ubuntu-latest
    if: ${{ ! contains(fromJson('["renovate[bot]", "dependabot[bot]"]'), github.actor) }}
    permissions:
      pull-requests: write
    steps:
      # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹å ´åˆã¯checkoutã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ãªã„ã¨å¤±æ•—ã™ã‚‹
      - uses: actions/checkout@v3
      - uses: actions/github-script@v7
        with:
          # @see https://docs.github.com/ja/rest/issues/assignees?apiVersion=2022-11-28#add-assignees-to-an-issue
          script: |
            const script = require('./.github/scripts/add-assignees.js')
            await script({github, context, core})

  create-comment:
    runs-on: ubuntu-latest
    if: ${{ ! contains(fromJson('["renovate[bot]", "dependabot[bot]"]'), github.actor) }}
    permissions:
      pull-requests: write
    steps:
      - uses: actions/checkout@v3
      - uses: actions/github-script@v7
        with:
          # @see https://docs.github.com/ja/rest/issues/comments?apiVersion=2022-11-28#create-an-issue-comment
          script: |
            const script = require('./.github/scripts/create-comment.js')
            await script({github, context, core})

  write-summary:
    runs-on: ubuntu-latest
    steps:
      # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹å ´åˆã¯checkoutã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ãªã„ã¨å¤±æ•—ã™ã‚‹
      - uses: actions/checkout@v3
      - uses: actions/github-script@v7
        with:
          script: |
            const script = require('./.github/scripts/write-summary.js')
            await script({github, context, core})

  slack-notification:
    name: Slack Notification
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2.2.0
      - name: Slack Notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_INCOMING_WEBHOOK_URL }}
          SLACK_LINK_NAMES: true # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã§ã®ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹
          SLACK_MESSAGE: |
            ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™ğŸ™ @engineers
            <${{ github.event.pull_request.html_url }}|${{ github.event.pull_request.title }}>
          SLACK_USERNAME: "ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŠé¡˜ã„ã—ã¾ã™ï¼Bot"
          MSG_MINIMAL: true # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ã‘ã‚’é€šçŸ¥æ–‡ã«ã™ã‚‹
